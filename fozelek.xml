<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <ModulePrefs 
        title="Feltétlenül főtt étel" 
        author="Kiss Péter" 
        author_email="ypetya@gmail.com"
        author_link="http://gadget.virgo.hu/~ypetya/author.html"
        author_photo="http://gadget.virgo.hu/~ypetya/author_photo.jpg"
        screenshot="http://gadget.virgo.hu/~ypetya/fozelek/screenshot.jpg"
        thumbnail="http://gadget.virgo.hu/~ypetya/fozelek/thumbnail.jpg"
        title_url="http://gadget.virgo.hu/~ypetya/fozelek/title.html"
        decription="Ez az alkalmazás a finomfőzelék c. paradoxon feloldására született. A főzelék, amely állítólag nevével ellentétben soha nem finom! Segítsünk hát neki!"
        >
        <Require feature="settitle"/>
        <Require feature="views"/> 
    </ModulePrefs>
<Content type="html" view="profile">
<![CDATA[
<!-- == Profil oldal ================================= -->
<div>Főzelék a profiloldalon. szeretem / nem szeretem. Státusz és csali szöveg</div>
]]>
</Content>
<Content type="html" view="canvas">

<![CDATA[
<!-- == Fő nézet ===================================== -->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/prototype/1.6.0.2/prototype.js"></script>
<script type="text/javascript">
    var fozelek=new function() {

        var log = function( var, val) {
            $('log').update( $('log').value + var + ' : ' + val + '<br/>' );
        }
/*
        var logActivity = function( txt ) {
            //történés rögzítése
            var params = {};
            params[opensocial.Activity.Field.TITLE] = txt;
            var activity = opensocial.newActivity(params);
            opensocial.requestCreateActivity(activity,opensocial.CreateActivityPriority.HIGH);
        }

        //beupdateljük az igazságot, ez majd segít eldönteni a finomfőzelékről...
        var lockDown = function(event,text) {
          Event.stop(event);
          $('az_igazsag').update( text );
          logActivity( text );
        }

        var setData = function( varname, data ) {
            var req = opensocial.newDataRequest();
            req.add(req.newUpdatePersonAppDataRequest("VIEWER", varname, data));
            req.send();   
        }

        var igen = function(event) {
            setData( 'fozelek', {szereti:igen} );
            lockDown(event,'Feltétlen főtt étel!');
        }

        var nem = function(event) {
            setData( 'fozelek', {szereti:nem} );
            lockDown(event,'Nem szeretem a főzeléket!' );
        }

        var extractFozelekData = function(data, person) {
            if(data[person.getId()]) {
                var fozi = gadgets.json.parse(gadgets.util.unescapeString(data[person.getId()]['fozelek']));
                        if( fozi.szereti == "igen" ){
                            return true;
                        }
                }

                return false;
        }

        var load = function(data) {
            alert('megjött!');
            var viewer = data.get('viewer').getData();
            var owner = data.get('owner').getData();
        }

        var requestData = function(){
            var viewer = opensocial.newIdSpec({ "userId" : "VIEWER" });
            var owner = opensocial.newIdSpec({ "userId" : "OWNER" });
            var req = opensocial.newDataRequest();
            req.add(req.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER), 'viewer');
            req.add(req.newFetchPersonRequest(opensocial.IdSpec.PersonId.OWNER), 'owner');
            req.add(req.newFetchPersonAppDataRequest(viewer, 'fozelek'), 'viewerData');
            req.add(req.newFetchPersonAppDataRequest(owner, 'fozelek'), 'ownerData');
            
            / * ezt a háttérben kéne kigyűjteni :)
            var friends_params = {};
            friends_params[opensocial.DataRequest.PeopleRequestFields.MAX] = 20;
            //név szerint rendezve
            friends_params[opensocial.DataRequest.PeopleRequestFields.SORT_ORDER] = opensocial.DataRequest.SortOrder.NAME;
            //csak azokat, akiknek telepítve van az alkalmazás
            friends_params[opensocial.DataRequest.PeopleRequestFields.FILTER] =	opensocial.DataRequest.FilterType.HAS_APP;
            var ownerFriends = opensocial.newIdSpec({ "userId" : "OWNER", "groupId" : "FRIENDS" });
            //ismerősök, es a hozzájuk tartozó alkalmazás-adatok
            req.add(req.newFetchPeopleRequest(ownerFriends, friends_params), 'ownerFriends');
            req.add(req.newFetchPersonAppDataRequest(ownerFriends, 'fozelek', friends_params), 'ownerFriendsData');

            * /


            alert('oninit');
            req.send(load);
        }
*/

        return {
            init: function() {
                alert('init');
                $('igen').observe('click', igen);
                $('nem').observe('click', nem);
                //requestData();
            }
        }
    }();

    alert('meghivja');
    gadgets.util.registerOnLoadHandler(fozelek.init);
</script>


<div id="az_igazsag" style="font-family:verdana;font-weight:bold;">
    
<form id="kutatas">
    <p>
        Finomfőzelék?
        <input id="igen" type="button" value="igen" style="float:left"/>
        <input id="nem" type="button" value="nem" style="float:left"/>
    </p>
</form>

</div>


<div id="log">Ide loggolunk...
</div>
]]>

</Content> 
</Module>

